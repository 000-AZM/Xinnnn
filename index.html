<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XinnLab Social</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        font-family: 'Roboto', sans-serif;
        background: #f0f2f5;
    }
    header {
        background: #1976d2;
        color: white;
        padding: 12px;
        font-size: 20px;
        font-weight: bold;
        text-align: center;
    }
    .container {
        max-width: 600px;
        margin: auto;
        padding: 10px;
    }
    .card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .post-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .post-name {
        font-weight: bold;
        color: #1976d2;
    }
    .post-time {
        font-size: 12px;
        color: #777;
    }
    .post-text {
        margin-top: 8px;
        font-size: 15px;
    }
    .input-card {
        display: flex;
        flex-direction: column;
        margin-bottom: 15px;
    }
    textarea {
        resize: none;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
    }
    button {
        margin-top: 5px;
        padding: 8px;
        background: #1976d2;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    button:hover {
        background: #135ca1;
    }
    /* Login Screen */
    #login-page {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: #f0f2f5;
    }
    #login-page input {
        margin: 5px;
        padding: 8px;
        font-size: 14px;
        width: 250px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
</style>
</head>
<body>

<div id="login-page">
    <h2>Login to XinnLab Social</h2>
    <input type="email" id="email" placeholder="Email (@xinn.lab)">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
</div>

<div id="main-page" style="display:none;">
    <header>XinnLab Social</header>
    <div class="container">
        <div class="input-card">
            <textarea id="postText" placeholder="What's on your mind?"></textarea>
            <button onclick="createPost()">Post</button>
        </div>
        <div id="feed"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyCGN7t5FjDeJ-ewm7S_9z0VJrRSggTaJ2Q",
  authDomain: "coin-base-by-hector.firebaseapp.com",
  databaseURL: "https://coin-base-by-hector-default-rtdb.firebaseio.com",
  projectId: "coin-base-by-hector",
  storageBucket: "coin-base-by-hector.firebasestorage.app",
  messagingSenderId: "398789890422",
  appId: "1:398789890422:web:ed6a928037b24be2e36a57",
  measurementId: "G-SGJJM5K3G9"
};


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginPage = document.getElementById('login-page');
    const mainPage = document.getElementById('main-page');
    const feed = document.getElementById('feed');

    function login(){
        let email = document.getElementById('email').value;
        let password = document.getElementById('password').value;
        signInWithEmailAndPassword(auth, email, password)
        .catch(err => alert(err.message));
    }

    function register(){
        let email = document.getElementById('email').value;
        if(!email.endsWith("@xinn.lab")){
            alert("Email must end with @xinn.lab");
            return;
        }
        let password = document.getElementById('password').value;
        createUserWithEmailAndPassword(auth, email, password)
        .catch(err => alert(err.message));
    }

    onAuthStateChanged(auth, user => {
        if(user){
            loginPage.style.display = "none";
            mainPage.style.display = "block";
            loadPosts();
        } else {
            loginPage.style.display = "flex";
            mainPage.style.display = "none";
        }
    });

    async function createPost(){
        let postText = document.getElementById('postText').value.trim();
        if(postText === "") return;
        await addDoc(collection(db, "posts"), {
            text: postText,
            uid: auth.currentUser.uid,
            email: auth.currentUser.email,
            time: serverTimestamp()
        });
        document.getElementById('postText').value = "";
    }

    function loadPosts(){
        const q = query(collection(db, "posts"), orderBy("time", "desc"));
        onSnapshot(q, snapshot => {
            feed.innerHTML = "";
            snapshot.forEach(doc => {
                let data = doc.data();
                let timeStr = data.time?.toDate ? data.time.toDate().toLocaleString() : "";
                feed.innerHTML += `
                    <div class="card">
                        <div class="post-header">
                            <span class="post-name">${data.email.split("@")[0]}</span>
                            <span class="post-time">${timeStr}</span>
                        </div>
                        <div class="post-text">${data.text}</div>
                    </div>
                `;
            });
        });
    }
</script>

</body>
</html>
